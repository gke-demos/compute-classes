steps:
  - name: 'gcr.io/cloud-builders/docker'
    args:
      - 'buildx'
      - 'create'
      - '--name'
      - 'mybuilder'
      - '--use'
  - name: 'gcr.io/cloud-builders/docker'
    args: 
      - 'buildx'
      - 'build'
      - '--platform'
      - 'linux/arm64,linux/amd64'
      - '-t'
      - 'us-docker.pkg.dev/$PROJECT_ID/${_REPO_NAME}/ping-demo:$SHORT_SHA'
      - '-t'
      - 'us-docker.pkg.dev/$PROJECT_ID/${_REPO_NAME}/ping-demo:latest'
      - '.'
  - name: 'gcr.io/cloud-builders/docker'
    args: 
      - 'images'
images:
  - 'us-docker.pkg.dev/$PROJECT_ID/${_REPO_NAME}/ping-demo:$SHORT_SHA'
  - 'us-docker.pkg.dev/$PROJECT_ID/${_REPO_NAME}/ping-demo:latest'  
options:
  requestedVerifyOption: 'VERIFIED'
  machineType: 'E2_HIGHCPU_8'
substitutions:
  _CLUSTER_NAME: ap-security-demo
  _REPO_NAME: gke-demos
